<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header(title = ${pageTitle},
includeHeaderFragment = ${'freezer-header'})"></head>

<body>
<nav th:replace="fragments/navigation :: navigation"></nav>
<div class="page-content">
    <section>
        add a friends freezer
        <form th:action="@{/user/freezer}" method="get" class="multiselect-form">
            <label for="freezerFriendList">Friends</label>
            <select id="freezerFriendList" class="multiselect" name="friends"
                    th:disabled="${userFriendships.isEmpty()}">
                <option value="" disabled selected>
                    [[${userFriendships.isEmpty() ? 'You have no Friends yet' : 'Select Friends'}]]
                </option>

                <option class="friend-option" th:if="${!userFriendships.isEmpty()}"
                        th:each="friendship : ${userFriendships}"
                        th:value="${friendship.requested_by.username != authenticated.username ? friendship.requested_by.username : friendship.request_to.username}">
                    [[${friendship.requested_by.username != authenticated.username ? friendship.requested_by.username :
                    friendship.request_to.username}]]
                </option>
            </select>
            <div class="multiselect-selected"><!-- Content inserted by multiselect.js --></div>
            <button type="submit" th:disabled="${userFriendships.isEmpty()}">Load Friends Freezer</button>
        </form>
    </section>

    <section class="card">
        <div th:each="freezerItem : ${freezer}" class="freezer-item">
            <span>[[${freezerItem.user.username}]]: [[${freezerItem.ingredient.name}]] -> amount: [[${freezerItem.amount}]]</span>
            <form th:action="@{/user/freezer/update}" method="post" th:if="${authenticated.id == freezerItem.user.id}">
                <input th:each="queryFriend : ${queryFriends}" type="hidden" name="friends" th:value="${queryFriend}">
                <input type="hidden" name="freezerIngredientId" th:value="${freezerItem.ingredient.id}">
                <button type="submit">+Add</button>
                <button type="submit" name="subtract" value="true" th:disabled="${freezerItem.amount == 0}">-Sub
                </button>
                <button type="submit" name="delete" value="true">Delete</button>
            </form>
        </div>

        <form th:action="@{/user/freezer}" method="post">
            <label>
                Amount:
                <input type="number" id="amount" name="amount" required>
            </label>

            <label>
                Ingredient Name:
                <input list="ingredientNames" name="ingredientName" id="ingredientName" required>
                <datalist id="ingredientNames">
                    <option th:each="ingredient : ${ingredients}" th:value="${ingredient.name}"></option>
                </datalist>
            </label>

            <input th:each="queryFriend : ${queryFriends}" type="hidden" name="friends" th:value="${queryFriend}">
            <button type="submit">Add to Freezer</button>
        </form>
    </section>

    <section class="card">
        Freezer Suggestions:
        <div class="freezer-suggestion" th:each="recipeSuggestion : ${freezerSuggestions}">
            [[${recipeSuggestion.recipe.title}]] with [[${recipeSuggestion.ingredientMatchingCount}]] matching
            ingredients:
            TODO: ADD RECIPE OVERVIEW:
            <button>TODO: Go to recipe</button>
            <button>TODO: Invite Friends to Cook this recipe (also with selector in recipe page)</button>
            <div class="suggestions-ingredients">
                <th:block
                        th:each="recipeIngredient: ${recipeSuggestion.recipe.recipeIngredients}">
                    <div th:each="freezerItem : ${freezer.?[ingredient.id == __${recipeIngredient.ingredient.id}__]}"
                         th:class="${freezerItem.amount < recipeIngredient.amount ? 'not-enough' : 'enough'}">
                        ([[${recipeIngredient.ingredient.name}]]) -> [[${freezerItem.amount}]] of
                        [[${recipeIngredient.amount}]]
                    </div>

                    <div th:if="${freezer.?[ingredient.id == __${recipeIngredient.ingredient.id}__].isEmpty()}"
                         class="missing">
                        ([[${recipeIngredient.ingredient.name}]]) -> 0 of [[${recipeIngredient.amount}]]
                    </div>
                </th:block>
            </div>
        </div>
    </section>
</div>

<!-- Scripts -->
<script type="text/javascript" th:src="@{/js/multiselect.js}"></script>
</body>
</html>