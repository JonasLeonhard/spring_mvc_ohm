<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header(title = ${pageTitle}, includeHeaderFragment = ${'profile-header'})"></head>

<body>
<nav th:replace="fragments/navigation :: navigation"></nav>

<div class="page-content">
    <th:block th:if="${profile != null}">
        <div class="profile-info-wrapper">
            <div class="sidebar-left">
                <img class="profile-image"
                     alt="profile picture"
                     th:title="${profile.username} + '\'s Profilepicture'"
                     th:src="${profile.picture != null ? '/resource/' + profile.picture.id : '/unsecured_files/placeholder_profile_image.png'}"/>

                <div class="profile-info">
                    <div class="p-info-wrapper">
                        <div>
                            <span>Username:</span>
                            <span>[[${profile.username}]]</span>
                        </div>
                        <div>
                            <span>Registered since:</span>
                            <span>[[${profile.createdAt}]]</span>
                        </div>
                        <div>
                            <span>Updated at:</span>
                            <span>[[${profile.updatedAt}]]</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sidebar-content-right">
                <form class="update-profile-form profile-card" th:action="@{/login}" th:object="${userForm}"
                      method="post"
                      th:if="${authenticated != null && authenticated.username == profile.username}">
                    <div class="input-wrapper">
                        <input th:field="*{username}"
                               placeholder=" "/>
                        <label th:for="*{username}" class="control-label">New Username</label>
                    </div>

                    <div class="input-wrapper">
                        <input th:field="*{password}"
                               placeholder=" "
                               type="password"/>
                        <label th:for="*{username}" class="control-label">New Password</label>
                    </div>

                    <div class="input-wrapper">
                        <input th:field="*{passwordConfirm}"
                               placeholder=" "
                               type="password"/>
                        <label th:for="*{passwordConfirm}" class="control-label">Commit Password</label>
                    </div>

                    <button type="submit" class="btn btn-success">Update Profile</button>
                </form>

                <div th:if="${authenticated != null && authenticated.username != profile.username}">
                    <div th:if="${friendship != null}" class="profile-card">
                        <th:block th:if="${friendship.accepted == true}">
                            you are friends with this profile
                        </th:block>
                        <th:block th:if="${friendship.accepted == false}">
                            <th:block th:if="${friendship.request_to.username == authenticated.username}">
                                Do you want to accept the friendrequest of [[${friendship.requested_by.username}]]
                            </th:block>
                            <th:block th:if="${friendship.request_to.username != authenticated.username}">
                                The friendrequest is still pending and has to be accepted by
                                [[${friendship.request_to.username}]]
                            </th:block>
                        </th:block>
                    </div>
                    <span th:if="${friendship == null}">
                         <form class="friend-request-form" th:action="@{/user/friendship}" method="post">
                            <button type="submit" class="btn btn-success" id="userId" name="userId"
                                    th:value="${profile.id}">Friend Request</button>
                        </form>
                    </span>
                </div>

                <div th:if="${authenticated != null && #sets.size(authenticated.friendshipsFromThisUser) > 0 && authenticated.username == profile.username}"
                     class="friendrequest-card profile-card">
                    <ul>
                        <th:block th:each="friendrequest : ${authenticated.friendshipsFromThisUser}">
                            <li th:if="${friendrequest.accepted == false}">Pending FriendRequest to:
                                [[${friendrequest.request_to.username}]]
                            </li>
                        </th:block>
                    </ul>
                </div>
            </div>
        </div>
    </th:block>

    <th:block th:unless="${profile != null}">
      <span>
         This Profile
         <span th:if="${userNotFound}">([[${userNotFound}]])</span>
         could not be found
      </span>
    </th:block>
</div>
</body>
</html>